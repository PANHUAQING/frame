<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>用户管理</title>
    <div th:replace="backstage/global::html" ></div>
    <style type="text/css">
        .content {
    margin: 50px auto;
    border: 1px solid #ccc;
  }

  .operation {
    margin: 10px;
  }

  .operation > button {
    margin: 10px;
  }

  #books_length {
    float: left;
    margin-left: 20px;
  }

  #books_filter {
    float: right;
    margin-right: 20px;
  }

  #books {
    margin: 5px;
  }

  .center-block {
    display: block;
    width: 21%;
    margin: auto;
  }
    
    </style>
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="ibox float-e-margins">
        <div class="panel panel-default">
            <div class="panel-heading">查询条件</div>
            <div class="panel-body">
                <form id="formSearch" class="form-horizontal">
                    <div class="form-group" style="margin-top:15px">
                        <label class="control-label col-sm-1" for="txt_search_departmentname">登录名</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="txt_search_departmentname">
                        </div>
                        <label class="control-label col-sm-1" for="txt_search_statu">性别</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="txt_search_statu">
                        </div>
                        <div class="col-sm-4" style="text-align:left;">
                            <button type="button" style="margin-left:50px" id="btn_query" class="btn btn-primary">查询</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>       
         
         <!-- toolbar 开始 -->
        <div id="toolbar" class="btn-group">
            <button id="btn_add" type="button" class="btn  btn-success" data-toggle="modal" data-target="#addModel">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
            </button>
        </div>
         <!-- toolbar 结束-->
         
            <div class="ibox-content">
                <div class="row row-lg">
                    <div class="col-sm-12">
                        <h4 class="example-title">用户管理</h4>
                        <div class="example">
                            <table id="grid" data-mobile-responsive="true"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
     <!-- End Panel Basic -->
        <!-- add 模拟框增加 -->
		<div class="modal fade" id="addModel" tabindex="-1" role="dialog" ria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title">添加用户</h4>
		      </div>
		      <div id="addBookModal" class="modal-body">
		        <div class="form-horizontal">
		          <div class="form-group">
		            <label for="loginname" class="col-sm-2 control-label">登录名:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="loginname" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="name" class="col-sm-2 control-label">用户名:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="name" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="password" class="col-sm-2 control-label">密码:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="password" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="bookPublish" class="col-sm-2 control-label">性别:*</label>
		            <div class="col-sm-10">
		              <input type="radio" name="sex" class="sex" id="man" value="1"/>男
					  <input type="radio" name="sex" class="sex" id="women" value="2"/>女
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="bookISBN" class="col-sm-2 control-label">电话号码:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="bookISBN" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="bookISBN" class="col-sm-2 control-label">微信:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="bookISBN" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="bookISBN" class="col-sm-2 control-label">年龄:</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="bookISBN" type="text">
		            </div>
		          </div>
		        </div>
		      </div>
		      <div class="modal-footer">
		        <div class="center-block">
		          <button id="cancelAdd" type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		          <button id="addObject" type="button" class="btn btn-success" data-dismiss="modal">保存</button>
		        </div>
		      </div>
		    </div>
		  </div>
		</div>
        <!-- end  模拟框结束 -->
        
         <!-- 修改 模拟框增加 -->
        <div class="modal fade" id="editModel" role="dialog">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title">修改图书内容</h4>
		      </div>
		      <div id="editBookModal" class="modal-body">
		        <div class="form-horizontal">
		          <div class="form-group">
		            <label for="editBookName" class="col-sm-2 control-label">书名:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="editBookName" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="editBookAuthor" class="col-sm-2 control-label">作者:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="editBookAuthor" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="editBookPrice" class="col-sm-2 control-label">价格:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="editBookPrice" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="editBookPublish" class="col-sm-2 control-label">出版社:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="editBookPublish" type="text">
		            </div>
		          </div>
		          <div class="form-group">
		            <label for="editBookISBN" class="col-sm-2 control-label">ISBN:*</label>
		            <div class="col-sm-10">
		              <input class="form-control" id="editBookISBN" type="text">
		            </div>
		          </div>
		        </div>
		      </div>
		      <div class="modal-footer">
		        <div class="center-block">
		          <button id="cancelEdit" type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		          <button id="saveEdit" type="button" class="btn btn-success" data-dismiss="modal">保存</button>
		        </div>
		      </div>
		    </div>
		  </div>
		</div>
        <!-- 修改 结束 -->
        
        <!-- 删除开始 -->
        <div class="modal fade" id="deleteModel" role="dialog">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title">确认要删除吗？</h4>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		        <button id="delete" type="button" class="btn btn-danger" data-dismiss="modal">删除</button>
		      </div>
		    </div>
		  </div>
		</div>
     <!-- 删除结束 -->
     
        <!-- 删除开始 -->
        <div class="modal fade" id="showModel" role="dialog">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title" id="showText"></h4>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		      </div>
		    </div>
		  </div>
		</div>
     <!-- 删除结束 -->
        
    <script type="text/javascript">
    var $table;
    $(function(){
    	//表格初始化
    	initTable();
    })
 
    //初始化bootstrap-table的内容
    function initTable () {
        //记录页面bootstrap-table全局变量$table，方便应用
        var queryUrl =[[@{/}]]+"backstage/userController/getUserList?rnd='" + Math.random()
        		
        $table = $('#grid').bootstrapTable({
            url: queryUrl,                      //请求后台的URL（*）
            method: 'GET',                      //请求方式（*）
            toolbar: '#toolbar',              //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            sortOrder: "asc",                   //排序方式
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1,                      //初始化加载第一页，默认第一页,并记录
            pageSize: 10,                      //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            search: false,                      //是否显示表格搜索
            strictSearch: true,
            showColumns: false,                  //是否显示所有的列（选择显示的列）
            showRefresh: false,                  //是否显示刷新按钮
            minimumCountColumns: 2,             //最少允许的列数
            clickToSelect: true,                //是否启用点击选中行
            //height: 500,                      //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "id",                     //每一行的唯一标识，一般为主键列
            showToggle: false,                   //是否显示详细视图和列表视图的切换按钮
            cardView: false,                    //是否显示详细视图
            detailView: false,                  //是否显示父子表
            //得到查询的参数
            queryParams : function (params) {
                //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
                var temp = {   
                    pageSize: params.limit,                         //页面大小
                    pageIndex: (params.offset / params.limit) + 1,   //页码
                    sort: params.sort,      //排序列名  
                    sortOrder: params.order //排位命令（desc，asc） 
                };
                return temp;
            },
            columns: [{
                checkbox: true,  
                visible: true                  //是否显示复选框  
            }, {
                field: 'loginname',
                title: '登录名',
                sortable: true
            }, {
                field: 'name',
                title: '用户真实姓名',
                sortable: true
            }, {
                field: 'sex',
                title: '性别',
                sortable: true ,
                formatter: function (value, row, index) {
					if(row.sex){
						if(row.sex==1){
							return "男";
						}else if(row.sex==2){
							return "女";
						}else{
							return "-";
						}
					}
				}
            }, {
                field: 'age',
                title: '年龄'
            }, {
                field: 'phone',
                title: '电话'
            }, {
                field: 'roleName',
                title: '角色'
            }, {
                field: 'strCreatedate',
                title: '创建时间'
            }, {
                field:'id',
                title: '操作',
                width: 160,
                align: 'center',
                valign: 'middle',
                formatter: function (value, row, index) {
					if(row.id){
						return '<button id="btn_edit" type="button" class="btn  btn-info" data-toggle="modal" data-target="#editModel">修改</button> <button id="btn_delete" type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModel">删除</button>';
					}
				}
            }, ],
            onLoadSuccess: function () {
            	
            	
            },
            onLoadError: function () {
                showTips("数据加载失败！");
            },
            onDblClickRow: function (row, $element) {
                var id = row.id;
                EditViewById(id, 'view');
            },
        });
    };
    
    //通过id查询
    function EditViewById(id,oper){
    	
    }
    
    
    // 编辑图书
    $('#btn_edit').click(function () {
    	alert(11222);
      if (table.rows('.selected').data().length) {
        $("#editModel").modal()
        var rowData = table.rows('.selected').data()[0];
        var inputs = $("#editModel").find('input')
        for (var i = 0; i < inputs.length; i++) {
          $(inputs[i]).val(rowData[i + 1])
        }
      } else {
        alert('请选择项目');
      }
    });
    
     　//在调用 show 方法后触发
    $('#editModel').on('show.bs.modal', function () {
    	 var rows = $table.bootstrapTable('getSelections');
    	 //选择一条数据修改
    	 if(rows.length==1){
    		  console.info(rows);
    	 }else{
    		 /* $("#showText").text("请选择需要修改的单条数据！")
    		 $("#showModel").modal('show');
    		 $("#editModel").model('hide'); */
    	 }
    })
    
    
    // 添加用户
    $("#addObject").on('click', function() {
      if (data.length) {
        if ($("#addBookModal").find('input').val() !== '') {
          var bookName = $("#bookName").val()
          var bookAuthor = $("#bookAuthor").val()
          var bookPrice = $("#bookPrice").val()
          var bookPublish = $("#bookPublish").val()
          var bookISBN = $("#bookISBN").val()
          var addBookInfos = [].concat(bookName, bookAuthor, bookPrice, bookPublish, bookISBN);
          
          for (var i = 0; i < addBookInfos.length; i++) {
            if (addBookInfos[i] === '') {
              alert(titles[i] + '内容不能为空')
            }
          }
          table.row.add(['', bookName, bookAuthor, bookPrice, bookPublish, bookISBN]).draw();
          $("#addBookModal").find('input').val('')
        }
      } else {
        alert('请输入内容')
      }
    })
    
 
    </script>
</body>
          

</html>